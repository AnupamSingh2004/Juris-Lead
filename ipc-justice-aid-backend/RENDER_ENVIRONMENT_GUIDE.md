# üîß Render Environment Variables Guide

## How Render Handles Environment Variables

Render uses a **two-tier system** for environment variables:

### 1. **render.yaml** (Default Values & Structure)
- Defines the **structure** and **default values**
- Gets committed to your git repository
- Sets up the environment variable **names** and **types**

### 2. **Render Dashboard** (Sensitive Values)
- Where you **manually set sensitive values**
- Not stored in git (secure)
- Overrides values from render.yaml

## üéØ Environment Variable Types in render.yaml

### **Fixed Values** (Public, Safe to Commit)
```yaml
- key: DEBUG
  value: "False"  # ‚úÖ Safe - public configuration
```

### **Generated Values** (Auto-created by Render)
```yaml
- key: SECRET_KEY
  generateValue: true  # ‚úÖ Render generates secure random value
```

### **Service References** (Auto-connected by Render)
```yaml
- key: DATABASE_URL
  fromDatabase:
    name: ipc-justice-aid-db
    property: connectionString  # ‚úÖ Auto-connected to your database
```

### **Manual Values** (Set in Dashboard)
```yaml
- key: GEMINI_API_KEY
  sync: false  # ‚ùó You MUST set this manually in Render dashboard
```

## üöÄ Your Current Configuration

### **Automatic** (No Action Needed)
- `DEBUG=False` - Set automatically
- `SECRET_KEY` - Generated by Render
- `DATABASE_URL` - Connected to PostgreSQL service
- `REDIS_URL` - Connected to Redis service
- `FRONTEND_URL=https://juris-lead.vercel.app` - Set automatically

### **Manual Setup Required** (In Render Dashboard)
After deployment, you need to set these in Render Dashboard:

1. **GEMINI_API_KEY** ‚≠ê **REQUIRED**
   ```
   Value: [Copy from your .env file: RENDER_GEMINI_API_KEY]
   ```

2. **EMAIL_HOST_USER** (Optional)
   ```
   Value: [Copy from your .env file: RENDER_EMAIL_HOST_USER]
   ```

3. **EMAIL_HOST_PASSWORD** (Optional)
   ```
   Value: [Copy from your .env file: RENDER_EMAIL_HOST_PASSWORD]
   ```

4. **GOOGLE_OAUTH_CLIENT_ID** (Optional)
   ```
   Value: [Copy from your .env file: RENDER_GOOGLE_OAUTH_CLIENT_ID]
   ```

5. **GOOGLE_OAUTH_CLIENT_SECRET** (Optional)
   ```
   Value: [Copy from your .env file: RENDER_GOOGLE_OAUTH_CLIENT_SECRET]
   ```

## üìã Step-by-Step: Setting Environment Variables in Render

### Step 1: Deploy Your App
1. Go to https://dashboard.render.com
2. Click "New" ‚Üí "Blueprint"
3. Connect your GitHub repository
4. Render reads `render.yaml` and creates services

### Step 2: Copy Values from Your .env File
Open your `.env` file and locate the section marked "RENDER DEPLOYMENT ENVIRONMENT VARIABLES". You'll find all the values you need with the `RENDER_` prefix.

### Step 3: Set Environment Variables in Render Dashboard
1. Go to your deployed web service
2. Click "Environment" tab
3. Add/Edit the following variables:

**üîë REQUIRED (App won't work without this):**
- Key: `GEMINI_API_KEY`
- Value: Copy from `RENDER_GEMINI_API_KEY` in your .env file

**üìß OPTIONAL (For email functionality):**
- Key: `EMAIL_HOST_USER`
- Value: Copy from `RENDER_EMAIL_HOST_USER` in your .env file

- Key: `EMAIL_HOST_PASSWORD`
- Value: Copy from `RENDER_EMAIL_HOST_PASSWORD` in your .env file

**üîê OPTIONAL (For Google OAuth login):**
- Key: `GOOGLE_OAUTH_CLIENT_ID`
- Value: Copy from `RENDER_GOOGLE_OAUTH_CLIENT_ID` in your .env file

- Key: `GOOGLE_OAUTH_CLIENT_SECRET`
- Value: Copy from `RENDER_GOOGLE_OAUTH_CLIENT_SECRET` in your .env file

**üí≥ OPTIONAL (For payment gateways if needed):**
- Key: `RAZORPAY_KEY_ID`
- Value: Copy from `RENDER_RAZORPAY_KEY_ID` in your .env file

- Key: `RAZORPAY_KEY_SECRET`
- Value: Copy from `RENDER_RAZORPAY_KEY_SECRET` in your .env file

### Step 4: Deploy Changes
- Click "Save Changes"
- Render automatically redeploys with new environment variables

## üîç How to Verify Environment Variables

### 1. Check Health Endpoint
```bash
curl https://your-app.onrender.com/legal/health/
```

Expected response:
```json
{
  "status": "healthy",
  "service": "IPC Justice Aid Backend",
  "analysis_service": "gemini",
  "database": "connected",
  "redis": "connected"
}
```

### 2. Check Service Info Endpoint
```bash
curl https://your-app.onrender.com/leads/service-info/
```

Expected response:
```json
{
  "primary_service": "gemini",
  "environment": "auto",
  "services_available": {
    "gemini": true,
    "ollama": false
  }
}
```

## üõ°Ô∏è Security Best Practices

### ‚úÖ What's Safe in render.yaml
- Public configuration (DEBUG, FRONTEND_URL)
- Service connections (DATABASE_URL references)
- Non-sensitive defaults

### ‚ùå What Should NEVER be in render.yaml
- API keys (GEMINI_API_KEY)
- Passwords (EMAIL_HOST_PASSWORD)
- OAuth secrets (GOOGLE_OAUTH_CLIENT_SECRET)
- Database credentials (handled by Render)

## üîÑ Development vs Production

| Variable | Development | Production (Render) |
|----------|-------------|-------------------|
| `GEMINI_API_KEY` | Set in `.env` | Set in Render Dashboard |
| `DEBUG` | `True` | `False` (from render.yaml) |
| `DATABASE_URL` | Local PostgreSQL | Render PostgreSQL |
| `FRONTEND_URL` | `localhost:3000` | `juris-lead.vercel.app` |
| `ANALYSIS_ENVIRONMENT` | `auto` (‚Üí ollama) | `auto` (‚Üí gemini) |

## üéØ CORS Configuration

Your app is now configured for:
- ‚úÖ **Production**: `https://juris-lead.vercel.app`
- ‚úÖ **Development**: `http://localhost:3000`
- ‚úÖ **Testing**: Various localhost ports

## üÜò Troubleshooting

### "Gemini API key not configured"
- ‚úÖ Set `GEMINI_API_KEY` in Render Dashboard
- ‚úÖ Redeploy after setting

### "CORS error from frontend"
- ‚úÖ Check `FRONTEND_URL` is set correctly
- ‚úÖ Check `CORS_ALLOWED_ORIGINS` includes your frontend

### "Database connection failed"
- ‚úÖ Usually auto-resolves (Render manages this)
- ‚úÖ Check PostgreSQL service is running

## üìû Support Links

- **Render Environment Variables**: https://render.com/docs/environment-variables
- **Render Dashboard**: https://dashboard.render.com
- **Your Frontend**: https://juris-lead.vercel.app

---

## ‚úÖ Quick Checklist

After deployment:
- [ ] App deployed successfully
- [ ] `GEMINI_API_KEY` set in Render Dashboard
- [ ] Health check returns "healthy"
- [ ] Service info shows "gemini" as primary
- [ ] Frontend can connect (CORS working)
- [ ] Email settings configured (optional)
- [ ] Google OAuth configured (optional)

**Your app will automatically use Gemini in production and Ollama for local development!** üöÄ
